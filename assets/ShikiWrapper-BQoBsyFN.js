import{r as u,j as p}from"./index-M3pXe0T4.js";import{c as k,a as y}from"./helper-CaAdfMs7.js";import{u as C,g as _}from"./viewport-DUHAwfyq.js";import"./request-D0R88Di3.js";import{s as R}from"./spring-BiPrtYZ-.js";import{m as E}from"./motion-minimal-GkgNfZih.js";import{u as M}from"./use-event-callback-D_bubOLe.js";import{s as L}from"./dom-XXNktKeO.js";import{t as O}from"./toast-QlB5oV8N.js";import{M as A}from"./StyledButton-Du9KJwW8.js";const I=({children:e,className:r,duration:t=.6,spring:i=!1})=>{const s=u.useRef(null),[n,a]=u.useState("auto");return u.useEffect(()=>{if(s.current){const o=new ResizeObserver(h=>{const d=h[0].contentRect.height;a(d)});return o.observe(s.current),()=>{o.disconnect()}}},[]),p.jsx(E.div,{className:k("overflow-hidden",r),style:{height:n},initial:!1,animate:{height:n},transition:i?R:{duration:t},children:p.jsx("div",{ref:s,children:e})})},j=0,$=({ref:e,size:r="base",element:t,selector:i}={})=>{const s=u.useRef(null),[n,a]=u.useState(!1),[o,h]=u.useState(!1),[d,l]=u.useState(!1),m=C(c=>c.h),f=u.useCallback(()=>{let c=s.current||e?.current||t;if(c)return i&&(c=c.querySelector(i)),c},[e,i,t]),g=M(()=>{const c=f();if(!c)return;if(c.scrollHeight<=c.clientHeight+2){l(!1),a(!1),h(!1);return}l(!0);const H=c.scrollTop+c.clientHeight>=c.scrollHeight-j,x=c.scrollTop<=j;a(H),h(x)});u.useEffect(()=>{const c=f();if(c)return c.addEventListener("scroll",g),()=>{c.removeEventListener("scroll",g)}},[g,f,t]),u.useEffect(()=>{g()},[g,m,t]);const v={base:"",lg:"-lg"}[r];return[s,d?y(n&&"mask-t",o&&"mask-b",!n&&!o&&"mask-both")+v:""]},N={"code-card":"_code-card_13eh4_1","scroll-container":"_scroll-container_13eh4_77"};function S(e,r,t,i=!1){return{name:e,code(s){const n=s.children.filter(o=>o.type==="element"),a=[];n.forEach((o,h)=>{let d;for(const l of o.children){if(l.type!=="element")continue;const m=l.children[0];if(m.type!=="text")continue;let f=!1;m.value=m.value.replace(r,(...g)=>t.call(this,g,o,l,n,h)?(f=!0,""):g[0]),f&&!m.value.trim()&&(d=l)}if(d&&(o.children.splice(o.children.indexOf(d),1),o.children.length===0&&(a.push(o),i))){const l=s.children[s.children.indexOf(o)+1];l&&l.type==="text"&&l.value===`
`&&a.push(l)}});for(const o of a)s.children.splice(s.children.indexOf(o),1)}}}function z(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(e={},r="@shikijs/transformers:notation-map"){const{classMap:t={},classActivePre:i=void 0}=e;return S(r,new RegExp(`\\s*(?://|/\\*|<!--|#)\\s+\\[!code (${Object.keys(t).map(z).join("|")})(:\\d+)?\\]\\s*(?:\\*/|-->)?`),function([s,n,a=":1"],o,h,d,l){const m=Number.parseInt(a.slice(1),10);return d.slice(l,l+m).forEach(f=>{this.addClassToHast(f,t[n])}),i&&this.addClassToHast(this.pre,i),!0})}function B(e={}){const{classActiveLine:r="highlighted",classActivePre:t="has-highlighted"}=e;return w({classMap:{highlight:r,hl:r},classActivePre:t},"@shikijs/transformers:notation-highlight")}function P(e,r,t,i){const s=T(e);let n=s.indexOf(t);for(;n!==-1;)W.call(this,e.children,r,n,t.length,i),n=s.indexOf(t,n+1)}function T(e){return e.type==="text"?e.value:e.type==="element"&&e.tagName==="span"?e.children.map(T).join(""):""}function W(e,r,t,i,s){let n=0;for(let a=0;a<e.length;a++){const o=e[a];if(o.type!=="element"||o.tagName!=="span"||o===r)continue;const h=o.children[0];if(h.type==="text"){if(q([n,n+h.value.length-1],[t,t+i])){const d=Math.max(0,t-n),l=i-Math.max(0,n-t);if(l===0)continue;const m=D(o,h,d,l);this.addClassToHast(m[1],s);const f=m.filter(Boolean);e.splice(a,1,...f),a+=f.length-1}n+=h.value.length}}}function q(e,r){return e[0]<=r[1]&&e[1]>=r[0]}function D(e,r,t,i){const s=r.value,n=a=>V(e,{children:[{type:"text",value:a}]});return[t>0?n(s.slice(0,t)):void 0,n(s.slice(t,t+i)),t+i<s.length?n(s.slice(t+i)):void 0]}function V(e,r){return{...e,properties:{...e.properties},...r}}function F(e={}){const{classActiveWord:r="highlighted-word",classActivePre:t=void 0}=e;return S("@shikijs/transformers:notation-highlight-word",/^\s*(?:\/\/|\/\*|<!--|#)\s+\[!code word:((?:\\.|[^:\]])+)(:\d+)?\]\s*(?:\*\/|-->)?/,function([i,s,n],a,o,h,d){const l=n?Number.parseInt(n.slice(1),10):h.length;return s=s.replace(/\\(.)/g,"$1"),h.slice(d+1,d+1+l).forEach(m=>P.call(this,m,o,s,r)),t&&this.addClassToHast(this.pre,t),!0},!0)}function U(e={}){const{classLineAdd:r="diff add",classLineRemove:t="diff remove",classActivePre:i="has-diff"}=e;return w({classMap:{"++":r,"--":t},classActivePre:i},"@shikijs/transformers:notation-diff")}function G(e){if(!e)return null;const r=e.match(/{([\d,-]+)}/);return r?r[1].split(",").flatMap(i=>{const s=i.split("-").map(n=>Number.parseInt(n,10));return s.length===1?[s[0]]:Array.from({length:s[1]-s[0]+1},(n,a)=>a+s[0])}):null}const b=Symbol("highlighted-lines");function J(e={}){const{className:r="highlighted"}=e;return{name:"@shikijs/transformers:meta-highlight",line(t,i){var s;return this.options.meta?.__raw?((s=this.meta)[b]||(s[b]=G(this.options.meta.__raw)),(this.meta[b]||[]).includes(i)&&this.addClassToHast(t,r),t):void 0}}}function le(e,{lang:r,attrs:t,code:i}){const s={lang:r,meta:{__raw:t},themes:{light:"github-light",dark:"github-dark"}};return e.codeToHtml(i,{...s,transformers:[...s.transformers||[],U(),B(),F(),J()]})}const K=e=>{const r=e.match(/filename="([^"]+)"/);return r?r[1]:null},ce=e=>["javascript","typescript","ts","js","css","tsx","jsx","json","sql","markdown","vue","rust","go","cpp","c","html","asm","bash","ps","ps1","text","plaintext","txt","plain"].includes(e.toLowerCase()),Q=u.forwardRef((e,r)=>{const{lang:t,content:i,attrs:s}=e,n=u.useCallback(()=>{navigator.clipboard.writeText(i),O.success("已复制到剪贴板")},[i]),[a,o]=u.useState(null);u.useImperativeHandle(r,()=>a);const[h,d]=u.useState(!0),[l,m]=u.useState(!1);u.useEffect(()=>{const c=a;if(!c)return;const x=_().h/2;c.scrollHeight>=x?(m(!0),c.querySelector(".highlighted")?.scrollIntoView({block:"center"})):m(!1)},[i,a]);const f=u.useMemo(()=>K(s||""),[s]),[,g]=$({element:a,size:"lg"}),v=!!f;return p.jsxs("div",{className:y(N["code-card"],"group"),onCopy:L,children:[!!f&&p.jsxs("div",{className:"z-10 flex w-full items-center justify-between rounded-t-xl bg-accent/20 px-5 py-2 text-sm",children:[p.jsx("span",{className:"shrink-0 grow truncate",children:f}),p.jsx("span",{className:"pointer-events-none shrink-0 grow-0","aria-hidden":!0,children:t?.toUpperCase()})]}),!f&&!!t&&p.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute bottom-3 right-3 z-10 text-sm opacity-60",children:t.toUpperCase()}),p.jsxs("div",{className:"bg-accent/5 py-4",children:[p.jsx(A,{onClick:n,className:y("absolute right-2 top-2 z-[1] flex text-xs center","rounded-md border border-accent/5 bg-accent/80 p-1.5 text-white backdrop-blur duration-200","opacity-0 group-hover:opacity-100",f&&"!top-12"),children:p.jsx("i",{className:"icon-[mingcute--copy-2-fill] size-4"})}),p.jsxs(I,{spring:!0,className:"relative",children:[p.jsx("div",{ref:o,className:k("relative max-h-[50vh] w-full overflow-auto",h?l?g:"":"!max-h-full",N["scroll-container"]),style:{"--sr-margin":v?"1rem":`${(t?.length||0)*14+4}px`},dangerouslySetInnerHTML:e.renderedHTML?{__html:e.renderedHTML}:void 0,children:e.children}),l&&h&&p.jsx("div",{className:`absolute inset-x-0 bottom-0 flex justify-center py-2 duration-200 ${["mask-both-lg","mask-b-lg"].includes(g)?"":"pointer-events-none opacity-0"}`,children:p.jsxs("button",{onClick:()=>d(!1),"aria-hidden":!0,className:"flex items-center justify-center text-xs",children:[p.jsx("i",{className:"icon-[mingcute--arrow-to-down-line]"}),p.jsx("span",{className:"ml-2",children:"展开"})]})})]})]})]})});Q.displayName="ShikiHighLighterWrapper";export{I as A,Q as S,le as c,ce as i};
